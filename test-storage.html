<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storage Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Storage System Test</h1>
    
    <div class="test-section info">
        <h3>üîç Checking localStorage for imported events...</h3>
        <div id="storage-status">Loading...</div>
    </div>

    <div class="test-section info">
        <h3>üìä Storage Details</h3>
        <div id="storage-details">Loading...</div>
    </div>

    <div class="test-section info">
        <h3>üóëÔ∏è Test Actions</h3>
        <button onclick="clearStorage()">Clear Storage</button>
        <button onclick="addTestEvent()">Add Test Event</button>
        <button onclick="refreshTest()">Refresh Test</button>
    </div>

    <script>
        function checkStorage() {
            const storageStatus = document.getElementById('storage-status');
            const storageDetails = document.getElementById('storage-details');
            
            try {
                // Check if localStorage is available
                if (typeof(Storage) !== "undefined") {
                    storageStatus.innerHTML = '<span style="color: green;">‚úÖ localStorage is available</span>';
                } else {
                    storageStatus.innerHTML = '<span style="color: red;">‚ùå localStorage is not available</span>';
                    return;
                }

                // Check for whtzup-events
                const storedEvents = localStorage.getItem('whtzup-events');
                
                if (storedEvents) {
                    const events = JSON.parse(storedEvents);
                    storageStatus.innerHTML = `
                        <span style="color: green;">‚úÖ Found stored events!</span><br>
                        <strong>Total events: ${events.length}</strong>
                    `;
                    
                    // Count imported events
                    const importedEvents = events.filter(event => event.id && event.id.startsWith('imported-'));
                    const originalEvents = events.filter(event => event.id && !event.id.startsWith('imported-'));
                    
                    storageDetails.innerHTML = `
                        <p><strong>Original events:</strong> ${originalEvents.length}</p>
                        <p><strong>Imported events:</strong> ${importedEvents.length}</p>
                        <p><strong>Total events:</strong> ${events.length}</p>
                        
                        <h4>Recent imported events:</h4>
                        <pre>${JSON.stringify(importedEvents.slice(0, 3), null, 2)}</pre>
                        
                        <h4>All events (first 5):</h4>
                        <pre>${JSON.stringify(events.slice(0, 5), null, 2)}</pre>
                    `;
                } else {
                    storageStatus.innerHTML = '<span style="color: orange;">‚ö†Ô∏è No stored events found in localStorage</span>';
                    storageDetails.innerHTML = '<p>No events have been imported yet or storage was cleared.</p>';
                }
                
            } catch (error) {
                storageStatus.innerHTML = `<span style="color: red;">‚ùå Error checking storage: ${error.message}</span>`;
                storageDetails.innerHTML = `<p>Error: ${error.message}</p>`;
            }
        }

        function clearStorage() {
            if (confirm('Are you sure you want to clear all stored events?')) {
                localStorage.removeItem('whtzup-events');
                alert('Storage cleared!');
                refreshTest();
            }
        }

        function addTestEvent() {
            const testEvent = {
                id: `imported-test-${Date.now()}`,
                name: "Test Imported Event",
                description: "This is a test event to verify storage",
                latitude: 58.2542245,
                longitude: 22.489828,
                startsAt: "2025-01-15 19:00",
                url: "",
                venue: "Test Venue",
                address: "Test Address",
                source: "csv"
            };

            const existingEvents = localStorage.getItem('whtzup-events');
            let events = [];
            
            if (existingEvents) {
                events = JSON.parse(existingEvents);
            }
            
            events.push(testEvent);
            localStorage.setItem('whtzup-events', JSON.stringify(events));
            
            alert('Test event added!');
            refreshTest();
        }

        function refreshTest() {
            checkStorage();
        }

        // Run test on page load
        checkStorage();
    </script>
</body>
</html>
